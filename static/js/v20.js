'use strict';function aa(a){var c=0;return function(){return c<a.length?{done:!1,value:a[c++]}:{done:!0}}}function g(a){var c="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return c?c.call(a):{next:aa(a)}}var h="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this,ba="function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,b){a!=Array.prototype&&a!=Object.prototype&&(a[c]=b.value)};
function l(a,c){if(c){var b=h;a=a.split(".");for(var d=0;d<a.length-1;d++){var e=a[d];e in b||(b[e]={});b=b[e]}a=a[a.length-1];d=b[a];c=c(d);c!=d&&null!=c&&ba(b,a,{configurable:!0,writable:!0,value:c})}}l("Array.prototype.fill",function(a){return a?a:function(c,b,d){var e=this.length||0;0>b&&(b=Math.max(0,e+b));if(null==d||d>e)d=e;d=Number(d);0>d&&(d=Math.max(0,e+d));for(b=Number(b||0);b<d;b++)this[b]=c;return this}});
l("Array.from",function(a){return a?a:function(c,b,d){b=null!=b?b:function(t){return t};var e=[],f="undefined"!=typeof Symbol&&Symbol.iterator&&c[Symbol.iterator];if("function"==typeof f){c=f.call(c);for(var k=0;!(f=c.next()).done;)e.push(b.call(d,f.value,k++))}else for(f=c.length,k=0;k<f;k++)e.push(b.call(d,c[k],k));return e}});l("Object.is",function(a){return a?a:function(c,b){return c===b?0!==c||1/c===1/b:c!==c&&b!==b}});
l("Array.prototype.includes",function(a){return a?a:function(c,b){var d=this;d instanceof String&&(d=String(d));var e=d.length;b=b||0;for(0>b&&(b=Math.max(b+e,0));b<e;b++){var f=d[b];if(f===c||Object.is(f,c))return!0}return!1}});function m(a){var c=new XMLHttpRequest;c.open("POST","/api/log-analytics-event",!0);c.timeout=6E4;c.setRequestHeader("Content-Type","application/json");a.url=window.location.href;c.send(JSON.stringify(a))}
function n(a,c){m({type:"event",eventCategory:"btn_click",eventAction:a,eventLabel:c})}function p(a,c){c=void 0===c?null:c;a={type:"event",eventCategory:"game_event",eventAction:a};null!==c&&(a.eventValue=c.toString());m(a)};var q={D:"cairo",H:"sao-paulo",F:"london",I:"sydney",G:"san-francisco",J:"tokyo",K:"world"},r={},u=(r.cairo={"landmark/Cairo/food_cairo_1_Koshari":null,"landmark/Cairo/landmark_cairo_1_Pyramid_of_Khufu":{x:3,y:15},"landmark/Cairo/landmark_cairo_2_Great_Sphinx_of_Giza":{x:4,y:17},"landmark/Cairo/landmark_cairo_3_Cairo_Citadel":{x:17,y:7},"landmark/Cairo/landmark_cairo_4_Cairo_Tower":{x:15,y:5}},r.london={"landmark/London/food_london_1":null,"landmark/London/food_london_2":null,"landmark/London/landmark_london_1":{x:9,
y:11},"landmark/London/landmark_london_2":{x:11,y:11},"landmark/London/landmark_london_4_Mary_Axe":{x:18,y:7},"landmark/London/landmark_london_5_Tower_Bridge":{x:17,y:9}},r["san-francisco"]={"landmark/San_Francisco/food_sf_1_Fortune_cookie":null,"landmark/San_Francisco/landmark_sf_1_Palace_Of_Fine_Arts":{x:9,y:5},"landmark/San_Francisco/landmark_sf_2_Golden_Gate_Bridge":{x:4,y:3},"landmark/San_Francisco/landmark_sf_3_Coit_Tower":{x:15,y:4},"landmark/San_Francisco/landmark_sf_4_Ferry_Building":{x:17,
y:9}},r["sao-paulo"]={"landmark/Sao_Paulo/food_saop_1_Pastel":null,"landmark/Sao_Paulo/food_saop_2_Coxinha":null,"landmark/Sao_Paulo/landmark_saop_1_Sao_Paulo_Museum_of_Art":{x:8,y:10},"landmark/Sao_Paulo/landmark_saop_2_Sao_Paulo_Cathedral":{x:11,y:6},"landmark/Sao_Paulo/landmark_saop_3_Latin_America_Memorial":{x:6,y:4},"landmark/Sao_Paulo/landmark_saop_4_Beco_do_Batman":{x:1,y:11}},r.sydney={"landmark/Sydney/food_sydney_1_Lamingtons":null,"landmark/Sydney/food_sydney_2_Pavlova":null,"landmark/Sydney/landmark_sydney_1_Opera_House":{x:10,
y:9},"landmark/Sydney/landmark_sydney_2_Harbour_Bridge":{x:7,y:8},"landmark/Sydney/landmark_sydney_3_Luna_Park":{x:8,y:6},"landmark/Sydney/landmark_sydney_4_Sydney_Tower_Eye":{x:8,y:15}},r.tokyo={"landmark/Tokyo/food_tokyo_1_Sushi":null,"landmark/Tokyo/food_tokyo_2_Ramen":null,"landmark/Tokyo/landmark_tokyo_1_Senso-ji":{x:13,y:9},"landmark/Tokyo/landmark_tokyo_2_Tokyo_Tower":{x:7,y:15},"landmark/Tokyo/landmark_tokyo_3_Skytree":{x:10,y:6},"landmark/Tokyo/landmark_tokyo_4_Metropolitan_Government_Building":{x:2,
y:8}},r.world={"landmark/World/landmark_world_other_1_Burj_Khalifa":{x:12,y:10},"landmark/World/landmark_world_other_2_Burj_Al_Arab_Jumeirah":{x:12,y:10},"landmark/World/landmark_world_other_3_Petronas_Twin_Towers":{x:14,y:12},"landmark/World/landmark_world_other_4":{x:14,y:7},"landmark/World/landmark_world_other_6_Christ_the_Redeemer":{x:7,y:13},"landmark/World/landmark_world_other_7_CN_Tower":{x:5,y:7},"landmark/World/landmark_world_other_8_jiefangbei":{x:15,y:8},"landmark/World/landmark_world_other_9_New_Zealand_Sky_Tower":{x:18,
y:15}},r),v={},w=(v.cairo={x:11,y:9},v["sao-paulo"]={x:7,y:13},v.london={x:9,y:6},v.sydney={x:17,y:14},v["san-francisco"]={x:2,y:9},v.tokyo={x:18,y:8},v),x;for(x in w)for(var ca in u[x])u.world[ca]=w[x];
var da={v:[{x:0,y:0}],offset:{x:0,y:0}},y={v:[{x:0,y:0},{x:1,y:0}],offset:{x:.5,y:0}},z={v:[{x:-1,y:0},{x:0,y:0},{x:1,y:0}],offset:{x:0,y:0}},A={v:[{x:-1,y:0},{x:0,y:0},{x:1,y:0},{x:2,y:0}],offset:{x:.5,y:0}},B={"landmark/Cairo/landmark_cairo_1_Pyramid_of_Khufu":z,"landmark/Cairo/landmark_cairo_2_Great_Sphinx_of_Giza":z,"landmark/Cairo/landmark_cairo_3_Cairo_Citadel":A,"landmark/London/landmark_london_2":z,"landmark/London/landmark_london_5_Tower_Bridge":z,"landmark/San_Francisco/landmark_sf_2_Golden_Gate_Bridge":z,
"landmark/San_Francisco/landmark_sf_1_Palace_Of_Fine_Arts":y,"landmark/San_Francisco/landmark_sf_4_Ferry_Building":z,"landmark/Sao_Paulo/food_saop_2_Coxinha":y,"landmark/Sao_Paulo/landmark_saop_1_Sao_Paulo_Museum_of_Art":z,"landmark/Sao_Paulo/landmark_saop_2_Sao_Paulo_Cathedral":y,"landmark/Sao_Paulo/landmark_saop_4_Beco_do_Batman":y,"landmark/Sydney/landmark_sydney_1_Opera_House":z,"landmark/Sydney/landmark_sydney_2_Harbour_Bridge":A,"landmark/Sydney/landmark_sydney_3_Luna_Park":z,"landmark/Tokyo/landmark_tokyo_1_Senso-ji":y,
"landmark/Tokyo/landmark_tokyo_4_Metropolitan_Government_Building":y,"landmark/World/landmark_world_other_1_Burj_Khalifa":y,"landmark/World/landmark_world_other_2_Burj_Al_Arab_Jumeirah":y,"landmark/World/landmark_world_other_3_Petronas_Twin_Towers":y,"landmark/World/landmark_world_other_4":A},C={"landmark/Cairo/food_cairo_1_Koshari":118,"landmark/Cairo/food_cairo_2_Mahshi":119,"landmark/London/food_london_1":114,"landmark/London/food_london_2":115,"landmark/San_Francisco/food_sf_1_Fortune_cookie":109,
"landmark/Sao_Paulo/food_saop_1_Pastel":110,"landmark/Sao_Paulo/food_saop_2_Coxinha":111,"landmark/Sydney/food_sydney_1_Lamingtons":117,"landmark/Sydney/food_sydney_2_Pavlova":116,"landmark/Tokyo/food_tokyo_1_Sushi":112,"landmark/Tokyo/food_tokyo_2_Ramen":113,"landmark/World/food_world_other_1_Taco":120,"landmark/World/food_world_other_2_Croissant":121,"landmark/World/food_world_other_3_Pizza":122},D={"landmark/Cairo/landmark_cairo_1_Pyramid_of_Khufu":96,"landmark/Cairo/landmark_cairo_2_Great_Sphinx_of_Giza":97,
"landmark/Cairo/landmark_cairo_3_Cairo_Citadel":99,"landmark/Cairo/landmark_cairo_4_Cairo_Tower":98,"landmark/London/landmark_london_1":88,"landmark/London/landmark_london_2":89,"landmark/London/landmark_london_4_Mary_Axe":91,"landmark/London/landmark_london_5_Tower_Bridge":90,"landmark/San_Francisco/landmark_sf_1_Palace_Of_Fine_Arts":76,"landmark/San_Francisco/landmark_sf_2_Golden_Gate_Bridge":77,"landmark/San_Francisco/landmark_sf_3_Coit_Tower":78,"landmark/San_Francisco/landmark_sf_4_Ferry_Building":79,
"landmark/Sao_Paulo/landmark_saop_1_Sao_Paulo_Museum_of_Art":81,"landmark/Sao_Paulo/landmark_saop_2_Sao_Paulo_Cathedral":80,"landmark/Sao_Paulo/landmark_saop_3_Latin_America_Memorial":82,"landmark/Sao_Paulo/landmark_saop_4_Beco_do_Batman":83,"landmark/Sydney/landmark_sydney_1_Opera_House":92,"landmark/Sydney/landmark_sydney_2_Harbour_Bridge":93,"landmark/Sydney/landmark_sydney_3_Luna_Park":94,"landmark/Sydney/landmark_sydney_4_Sydney_Tower_Eye":95,"landmark/Tokyo/landmark_tokyo_1_Senso-ji":84,"landmark/Tokyo/landmark_tokyo_2_Tokyo_Tower":85,
"landmark/Tokyo/landmark_tokyo_3_Skytree":86,"landmark/Tokyo/landmark_tokyo_4_Metropolitan_Government_Building":87,"landmark/World/landmark_world_other_1_Burj_Khalifa":100,"landmark/World/landmark_world_other_2_Burj_Al_Arab_Jumeirah":101,"landmark/World/landmark_world_other_3_Petronas_Twin_Towers":102,"landmark/World/landmark_world_other_4":103,"landmark/World/landmark_world_other_6_Christ_the_Redeemer":104,"landmark/World/landmark_world_other_7_CN_Tower":105,"landmark/World/landmark_world_other_8_jiefangbei":106,
"landmark/World/landmark_world_other_9_New_Zealand_Sky_Tower":107};var E={},ea=Object.freeze((E[3]={x:-1,y:0},E[1]={x:1,y:0},E[2]={x:0,y:-1},E[4]={x:0,y:1},E));function F(a){switch(a){case 3:return 1;case 1:return 3;case 2:return 4;case 4:return 2;case 0:return 0;default:throw Error("Invalid direction");}};function fa(){this.height=this.width=20;this.b=[];for(var a=0;20>a;a++){var c=Array(20).fill(null);this.b.push(c)}}function G(a,c,b){H(a,c)&&(a.b[c.y][c.x]=b)}function I(a,c){return H(a,c)?a.b[c.y][c.x]:null}function H(a,c){return 0<=c.x&&c.x<a.width&&0<=c.y&&c.y<a.height};var ha="bg/cairo.png bg/london.png bg/san-francisco.png bg/sao-paulo.png bg/sydney.png bg/tokyo.png bg/world.png landmark/Cairo/food_cairo_1_Koshari.png landmark/Cairo/food_cairo_2_Mahshi.png landmark/Cairo/landmark_cairo_1_Pyramid_of_Khufu.png landmark/Cairo/landmark_cairo_2_Great_Sphinx_of_Giza.png landmark/Cairo/landmark_cairo_3_Cairo_Citadel.png landmark/Cairo/landmark_cairo_4_Cairo_Tower.png landmark/London/food_london_1.png landmark/London/food_london_2.png landmark/London/landmark_london_1.png landmark/London/landmark_london_2.png landmark/London/landmark_london_4_Mary_Axe.png landmark/London/landmark_london_5_Tower_Bridge.png landmark/San_Francisco/food_sf_1_Fortune_cookie.png landmark/San_Francisco/landmark_sf_1_Palace_Of_Fine_Arts.png landmark/San_Francisco/landmark_sf_2_Golden_Gate_Bridge.png landmark/San_Francisco/landmark_sf_3_Coit_Tower.png landmark/San_Francisco/landmark_sf_4_Ferry_Building.png landmark/San_Francisco/landmark_sf_5_Fisherman_s_Wharf.png landmark/Sao_Paulo/food_saop_1_Pastel.png landmark/Sao_Paulo/food_saop_2_Coxinha.png landmark/Sao_Paulo/landmark_saop_1_Sao_Paulo_Museum_of_Art.png landmark/Sao_Paulo/landmark_saop_2_Sao_Paulo_Cathedral.png landmark/Sao_Paulo/landmark_saop_3_Latin_America_Memorial.png landmark/Sao_Paulo/landmark_saop_4_Beco_do_Batman.png landmark/Sydney/food_sydney_1_Lamingtons.png landmark/Sydney/food_sydney_2_Pavlova.png landmark/Sydney/landmark_sydney_1_Opera_House.png landmark/Sydney/landmark_sydney_2_Harbour_Bridge.png landmark/Sydney/landmark_sydney_3_Luna_Park.png landmark/Sydney/landmark_sydney_4_Sydney_Tower_Eye.png landmark/Tokyo/food_tokyo_1_Sushi.png landmark/Tokyo/food_tokyo_2_Ramen.png landmark/Tokyo/landmark_tokyo_1_Senso-ji.png landmark/Tokyo/landmark_tokyo_2_Tokyo_Tower.png landmark/Tokyo/landmark_tokyo_3_Skytree.png landmark/Tokyo/landmark_tokyo_4_Metropolitan_Government_Building.png landmark/World/food_world_other_1_Taco.png landmark/World/food_world_other_2_Croissant.png landmark/World/food_world_other_3_Pizza.png landmark/World/landmark_world_other_1_Burj_Khalifa.png landmark/World/landmark_world_other_2_Burj_Al_Arab_Jumeirah.png landmark/World/landmark_world_other_3_Petronas_Twin_Towers.png landmark/World/landmark_world_other_4.png landmark/World/landmark_world_other_5.png landmark/World/landmark_world_other_6_Christ_the_Redeemer.png landmark/World/landmark_world_other_7_CN_Tower.png landmark/World/landmark_world_other_8_jiefangbei.png landmark/World/landmark_world_other_9_New_Zealand_Sky_Tower.png person/Pegman_0.png person/Pegman_1.png person/Pegman_2.png person/Pegman_3.png person/Pegman_4.png person/Pegman_5.png person/Pegman_6.png person/Pegman_7.png person/Pegman_8.png person/Pegman_9.png person/Pegman_10.png person/pegmen_platform.png train/cairo.png train/london.png train/san-francisco.png train/sao-paulo.png train/sydney.png train/tokyo.png train/world.png help/help-touch-frames.png".split(" "),
J={};function ia(){for(var a=g(ha),c=a.next();!c.done;c=a.next()){c=c.value;var b=new Image;b.src="static/img/"+c;J[c.split(".")[0]]=b}}function K(a){if(!J.hasOwnProperty(a))throw Error('No such image "'+a+'"');return J[a]};function ja(a,c,b,d){this.h=a;this.i=c;this.j=b;this.time=d;this.g=a;this.b=0}h.Object.defineProperties(ja.prototype,{done:{configurable:!0,enumerable:!0,get:function(){return this.b>this.time}}});function ka(){return function(a){.5>a?a={x:0,y:-0}:(a=(a-.5)/.5,a={x:0,y:-128*a*(1-a)});return a}};function L(a,c,b){c=void 0===c?null:c;b=void 0===b?null:b;this.g=a;this.h=[{x:0,y:0}];c&&(this.h=c);this.i={x:0,y:0};b&&(this.i=b);this.b={x:0,y:0};this.l=!1}function la(a,c){for(var b=g(a.h),d=b.next();!d.done;d=b.next())d=d.value,d={x:a.b.x+d.x,y:a.b.y+d.y},I(c,d)===a&&G(c,d,null)}function ma(a,c){for(var b=g(a.h),d=b.next();!d.done;d=b.next())d=d.value,G(c,{x:a.b.x+d.x,y:a.b.y+d.y},a)}function na(a){var c=K(a.g);return{x:32*(a.b.x+.5+a.i.x)-c.width/2,y:32*(a.b.y+1+a.i.y)-c.height+32}}
L.prototype.j=function(a){var c=K(this.g),b=na(this);a.drawImage(c,b.x,b.y)};var M={},oa=(M[[0,1]]={x:2,y:0},M[[0,2]]={x:3,y:0},M[[0,3]]={x:0,y:0},M[[0,4]]={x:1,y:0},M[[1,0]]={x:2,y:1},M[[2,0]]={x:3,y:1},M[[3,0]]={x:0,y:1},M[[4,0]]={x:1,y:1},M[[1,3]]={x:0,y:2},M[[3,1]]={x:1,y:2},M[[2,4]]={x:2,y:2},M[[4,2]]={x:3,y:2},M[[2,1]]={x:0,y:3},M[[1,2]]={x:0,y:3},M[[2,3]]={x:1,y:3},M[[3,2]]={x:1,y:3},M[[4,1]]={x:2,y:3},M[[1,4]]={x:2,y:3},M[[3,4]]={x:3,y:3},M[[4,3]]={x:3,y:3},M);function N(a,c){this.i=a;this.b={x:c.x,y:c.y};this.g=this.h=0}
N.prototype.j=function(a){if(0!==this.h||0!==this.g){var c=[this.h,this.g];c.sort();c=oa[c];var b=K("train/"+this.i);a.drawImage(b,32*c.x,64*c.y,32,64,32*this.b.x,32*(this.b.y-1)+32,32,64)}};function pa(a,c,b){this.j=a;this.g=[];this.b=[];this.i=1;this.h=!0;for(a=0;5>a;a++)this.b.push(new N(this.j,c));for(c=0;4>c;c++)qa(this,b);ra(this,b)}
function qa(a,c){if(a.h){0<a.g.length&&(a.i=a.g.shift());var b=a.b[0].b;var d=ea[a.i];b={x:b.x+d.x,y:b.y+d.y};if(H(c,b))if(d=I(c,b),d instanceof N)a.h=!1;else{d instanceof L&&(d.l=!0,la(d,c),a.b.push(new N(a.j,a.b[a.b.length-1].b)));d=g(a.b);for(var e=d.next();!e.done;e=d.next())G(c,e.value.b,null);d=a.b.pop();d.b=b;d.h=0;d.g=0;a.b.unshift(d);for(b=1;b<a.b.length;b++){d=a.b[b-1];e=a.b[b];var f={x:d.b.x-e.b.x,y:d.b.y-e.b.y};if(f.x&&f.y)throw Error("Invalid offset "+f+". Diagonals are not supported.");
f=f.x?0>f.x?3:1:f.y?0>f.y?2:4:0;e.h=f;d.g=F(f)}a.b[0].h=0;a.b[a.b.length-1].g=0;ra(a,c)}else a.h=!1}}function ra(a,c){a=g(a.b);for(var b=a.next();!b.done;b=a.next())b=b.value,G(c,b.b,b)};function O(a){var c=document.querySelector(".s"+a);if(null===c)throw Error('No string with id "'+a+'"');return c.innerText};function sa(a){this.j=a;this.A=!1;this.l=this.m=0;this.s=5;"world"===this.j&&(this.s=3);this.g=this.o=null;this.b=new fa;this.h=[];this.i=0;this.C=function(){};this.w=function(){};this.B=function(){};this.active=!0}sa.prototype.start=function(){for(var a=this.b,c=0;c<a.height;c++)for(var b=0;b<a.width;b++)a.b[c][b]=null;this.o=new pa(this.j,{x:Math.floor(.1*this.b.width),y:Math.floor(.5*this.b.height)},this.b);ta(this);this.i=0};
function ta(a){a:{var c=a.b;for(var b=0,d=0;d<c.height;d++)for(var e=0;e<c.width;e++)null===c.b[d][e]&&b++;if(0!==b)for(b=Math.floor(b*Math.random()),e=d=0;e<c.height;e++)for(var f=0;f<c.width;f++)if(null===c.b[e][f]){if(d===b){c={x:f,y:e};break a}d++}c=null}if(null===c)a.active=!1,a.w();else{a.l++;if(a.l>=a.s)for(b=u[a.j],d=Object.keys(b);0<d.length;){e=d.splice(Math.floor(d.length*Math.random()),1)[0];f=b[e];null===f&&(f=c);var k=B.hasOwnProperty(e)?B[e]:da;e=new L(e,k.v,k.offset);e.b=f;a:{f=a.b;
k=g(e.h);for(var t=k.next();!t.done;t=k.next())if(t=t.value,null!==I(f,{x:e.b.x+t.x,y:e.b.y+t.y})){f=!1;break a}f=!0}if(f){a.g=e;ma(a.g,a.b);a.l-=a.s;return}}a.g=new L("person/Pegman_"+Math.floor(11*Math.random()));a.g.b=c;ma(a.g,a.b)}}function P(a,c){var b=a.o,d=b.i;0<b.g.length&&(d=b.g[b.g.length-1]);c!==d&&c!==F(d)&&b.g.push(c);a.A||(a.B(),a.A=!0)};function ua(a){var c=document.querySelector("#game"),b=this;this.b=a;this.o=c.getContext("2d");this.m=this.h=0;this.g=null;this.active=!1;this.s=function(d){var e=d.code||d.key;if(e)switch(e){case "ArrowLeft":case "Left":case "KeyA":P(b.b,3);break;case "ArrowRight":case "Right":case "KeyD":P(b.b,1);break;case "ArrowUp":case "Up":case "KeyW":P(b.b,2);break;case "ArrowDown":case "Down":case "KeyS":P(b.b,4)}else switch(d.keyCode){case 37:case 65:P(b.b,3);break;case 39:case 68:P(b.b,1);break;case 38:case 87:P(b.b,
2);break;case 40:case 83:P(b.b,4)}};this.l=function(d){b.g=Q(d)};this.i=function(d){d=Q(d);va(b,d);b.g=null};this.j=function(d){d.preventDefault();d=Q(d);va(b,d);return!1}}function va(a,c){if(a.g){var b=c.x-a.g.x,d=c.y-a.g.y;10>Math.abs(b)&&10>Math.abs(d)||(Math.abs(b)>Math.abs(d)?0>b?P(a.b,3):P(a.b,1):0>d?P(a.b,2):P(a.b,4),a.g=c)}}
function Q(a){if(window.TouchEvent&&a instanceof TouchEvent)return{x:a.changedTouches[0].clientX,y:a.changedTouches[0].clientY};if(a instanceof MouseEvent)return{x:a.clientX,y:a.clientY};throw Error("invalid event type");}
function wa(){var a=R;a.active||(document.addEventListener("keydown",a.s),document.addEventListener("touchstart",a.l,{passive:!1}),document.addEventListener("mousedown",a.l),document.addEventListener("touchmove",a.j,{passive:!1}),document.addEventListener("mousemove",a.j),document.addEventListener("touchend",a.i,{passive:!1}),document.addEventListener("mouseup",a.i),a.m=Date.now(),window.requestAnimationFrame(function(){return xa(a)}),a.active=!0,a.b.start(),p("game_started"))}
function S(){var a=R;a.active&&(document.removeEventListener("keydown",a.s),document.removeEventListener("touchstart",a.l),document.removeEventListener("mousedown",a.l),document.removeEventListener("touchmove",a.j),document.removeEventListener("mousemove",a.j),document.removeEventListener("touchend",a.i),document.removeEventListener("mouseup",a.i),a.active=!1,p("game_ended",a.b.i))}
function xa(a){var c=Date.now();ya(a,(c-a.m)/1E3);za(a);a.m=c;a.active&&window.requestAnimationFrame(function(){return xa(a)})}
function ya(a,c){a.h+=c;if(.15<a.h){a.h%=.15;var b=a.b;if(b.active&&b.A)if(0<b.m)b.m--;else if(b.o.h){if(qa(b.o,b.b),b.g.l){la(b.g,b.b);var d=1,e=-1,f=b.g.g,k="";C.hasOwnProperty(f)?(d=5,e=C[f],k=f):D.hasOwnProperty(f)?(d=10,e=D[f],k=f):(f=new ja(na(b.g),b.g.g,ka(),.4),b.h.push(f));f="";0<e&&(f=O(e));b.i+=d;b.C(b.i,k,d,f);ta(b);b.m+=2}}else b.active=!1,b.w()}a=a.b;for(b=0;b<a.h.length;b++)d=a.h[b],d.b+=c,e=d.j(d.b/d.time),d.g={x:d.h.x+e.x,y:d.h.y+e.y},d.done&&(a.h.splice(b,1),b--)}
function za(a){var c=a.o;c.setTransform(1,0,0,1,0,0);c.clearRect(0,0,c.canvas.width,c.canvas.height);c=a.b;a=a.o;var b=K("bg/"+c.j);a.drawImage(b,0,32);b=c.b;for(var d=0;d<b.height;d++)for(var e=0;e<b.width;e++)b.b[d][e]&&b.b[d][e].j(a);c=g(c.h);for(b=c.next();!b.done;b=c.next())b=b.value,d=a,e=K(b.i),d.drawImage(e,b.g.x,b.g.y)};function Aa(){this.b=!1;this.h=this.g=0;this.i=Array.from(document.querySelectorAll(".touch-instructions")).map(function(a){return a.getContext("2d")});this.j=K("help/help-touch-frames")}Aa.prototype.start=function(){var a=this;this.h=Date.now();this.b||(this.b=!0,window.requestAnimationFrame(function(){return Ba(a)}))};function Ba(a){var c=Date.now();Ca(a,(c-a.h)/1E3);a.h=c;a.b&&window.requestAnimationFrame(function(){return Ba(a)})}
function Ca(a,c){a.g+=30*c;a.g%=53;var b=Math.floor(a.g);c=b%7;b=Math.floor(b/7);for(var d=g(a.i),e=d.next();!e.done;e=d.next())e=e.value,e.clearRect(0,0,e.canvas.width,e.canvas.height),e.drawImage(a.j,180*c,180*b,180,180,0,0,180,180)};m({type:"pageview"});var R=null,T=null,U=null,V=!1,Da=!1,W="home";
function Ea(){document.querySelector("#title-start-btn").addEventListener("click",function(){history.pushState({page:"cities"},"");Fa();n("play_game","from_"+W+"_screen")});for(var a={},c=g(document.querySelectorAll(".city-option")),b=c.next();!b.done;a={u:a.u},b=c.next())a.u=b.value,a.u.addEventListener("click",function(d){return function(){var e=d.u.getAttribute("data-city");Ga(e);n("select_city",e)}}(a));document.querySelector("#close-instructions-btn").addEventListener("click",function(){document.querySelector(".instructions").classList.add("hidden");
T.b=!1;Ha();wa();Da=!0;n("close_instructions","from_"+W+"_screen")});a=g(document.querySelectorAll(".back-btn"));for(b=a.next();!b.done;b=a.next())b.value.addEventListener("click",function(){R&&S();history.back();n("back","from_"+W+"_screen")});a=g(document.querySelectorAll(".double-back-btn"));for(b=a.next();!b.done;b=a.next())b.value.addEventListener("click",function(){R&&S();history.go(-2);n("home","from_"+W+"_screen")});document.querySelector(".facebook-link").addEventListener("click",function(){n("share_to_platform",
"facebook")});document.querySelector(".twitter-link").addEventListener("click",function(){n("share_to_platform","twitter")});document.querySelector(".email-link").addEventListener("click",function(){n("share_to_platform","email")});if("iGMM"===U||"aGMM"===U)for(a=g(document.querySelectorAll(".nav-close")),b=a.next();!b.done;b=a.next())b=b.value,b.classList.remove("hidden"),b.addEventListener("click",Ia);if("iGMM"===U||"aGMM"===U||navigator.share){a=g(document.querySelectorAll(".nav-share"));for(b=
a.next();!b.done;b=a.next())b=b.value,b.classList.remove("hidden"),b.addEventListener("click",Ja);a=g(document.querySelectorAll("#share-link"));for(b=a.next();!b.done;b=a.next())b=b.value,b.classList.remove("hidden"),b.addEventListener("click",Ja);document.querySelector(".share-icon-container").classList.add("hidden")}}
function Ka(){var a=document.querySelector(".language-used");if(null!==a&&["ar","fa","iw","ur"].includes(a.innerText)){var c=document.querySelectorAll(".nav-right");a=document.querySelectorAll(".back-btn .material-icons");for(var b=g(document.querySelectorAll(".nav-left")),d=b.next();!d.done;d=b.next())d=d.value,d.classList.remove("nav-left"),d.classList.add("nav-right");c=g(c);for(b=c.next();!b.done;b=c.next())b=b.value,b.classList.remove("nav-right"),b.classList.add("nav-left");a=g(a);for(c=a.next();!c.done;c=
a.next())c.value.innerText="arrow_forward"}}function X(){V=!0;document.removeEventListener("touchstart",X);document.removeEventListener("touchmove",X);document.removeEventListener("touchend",X)}function La(a){R&&S();"cities"===a.state.page?Fa():Ma()}function Na(a,c){webkit.messageHandlers.callFunction.postMessage({f:a,c:a,a:c})}function Oa(a,c){window.localpage_ext_NAAPI.callFunction(a,a,JSON.stringify(c))}
function Ja(a){a=void 0===a?null:a;null!==a&&a.preventDefault();n("native_share","from_"+W+"_screen");a=O(43);var c=O(131);if("iGMM"===U)Na("sg",{body:"#GoogleMapsSnake",url:c});else if("aGMM"===U)Oa("sg",{title:a,body:"#GoogleMapsSnake "+c});else if(navigator.share)navigator.share({title:a,text:"#GoogleMapsSnake",url:c});else throw Error("Not on a platform that supports sharing");}
function Ia(){n("exit","from_"+W+"_screen");if("iGMM"===U)Na("ewv",{});else if("aGMM"===U)Oa("ewv",{});else throw Error("Not on a platform that supports exiting");}function Y(){document.documentElement.style.setProperty("--ivh",window.innerHeight/100+"px")}function Ma(){Z();document.querySelector("#start-page").classList.remove("hidden");history.replaceState({page:"home"},"");W="home"}
function Fa(){Z();document.querySelector("#city-page").classList.remove("hidden");history.replaceState({page:"cities"},"");W="cities"}
function Ga(a){Z();document.querySelector("#game-page").classList.remove("hidden");document.querySelector(".destination-box").classList.remove("destination-appear");history.pushState({page:"game"},"");Pa(a);Qa();document.querySelector(".train-icon").src="static/img/train/"+a+"-full.png";a=new sa(a);R=new ua(a);a.B=function(){Ra()};a.w=function(){S();Z();document.querySelector("#score-page").classList.remove("hidden");history.replaceState({page:"score"},"");W="score"};a.C=function(c,b,d,e){Sa(c,b,
d,e)};Sa(0);Da?(Ha(),wa(),W="game"):(Ra(),document.querySelector(".instructions").classList.remove("hidden"),Qa(),T.start(),W="instructions");za(R)}function Ha(){document.querySelector(".extra-instructions").classList.remove("hidden");T.start()}function Ra(){document.querySelector(".extra-instructions").classList.add("hidden");T.b=!1}
function Qa(){for(var a=g(document.querySelectorAll(".instructions-icon")),c=a.next();!c.done;c=a.next())c.value.classList.add("hidden");if(V)for(a=g(document.querySelectorAll(".touch-instructions")),c=a.next();!c.done;c=a.next())c.value.classList.remove("hidden");else for(a=g(document.querySelectorAll(".keyboard-instructions")),c=a.next();!c.done;c=a.next())c.value.classList.remove("hidden")}
function Z(){for(var a=g(document.querySelectorAll(".page")),c=a.next();!c.done;c=a.next())c.value.classList.add("hidden")}
function Sa(a,c,b,d){c=void 0===c?"":c;b=void 0===b?0:b;d=void 0===d?"":d;a=""+a;for(var e=g(document.querySelectorAll(".score")),f=e.next();!f.done;f=e.next())f.value.innerText=a;0<c.length&&(c=K(c),document.querySelector(".destination-img").src=c.src,document.querySelector(".destination-score").innerText="+"+b,document.querySelector(".destination-label").innerText=d,document.querySelector(".destination-box").classList.remove("destination-appear"),setTimeout(function(){document.querySelector(".destination-box").classList.add("destination-appear")},
10))}function Pa(a){for(var c=g(document.querySelectorAll(".city-bg")),b=c.next();!b.done;b=c.next()){b=b.value;for(var d=g(Object.keys(q)),e=d.next();!e.done;e=d.next())b.classList.remove(q[e.value]+"-bg");b.classList.add(a+"-bg")}a=document.querySelector("."+a+"-label").innerText;c=g(document.querySelectorAll(".destination-title"));for(b=c.next();!b.done;b=c.next())b.value.innerText=a}
window.addEventListener("load",function(){"undefined"!==typeof URLSearchParams&&(U=(new URLSearchParams(location.search)).get("utm_source"));Y();Ka();window.addEventListener("resize",function(){Y();setTimeout(Y,10)});Ea();if("iGMM"===U){for(var a=g(document.querySelectorAll(".nav-container")),c=a.next();!c.done;c=a.next())c.value.classList.add("nav-container-ios");a=g(document.querySelectorAll(".nav-spacer"));for(c=a.next();!c.done;c=a.next())c.value.classList.add("nav-spacer-ios");a=g(document.querySelectorAll(".game-container"));
for(c=a.next();!c.done;c=a.next())c.value.classList.add("game-container-ios")}window.addEventListener("popstate",La);"iGMM"===U||"aGMM"===U?V=!0:(document.addEventListener("touchstart",X),document.addEventListener("touchmove",X),document.addEventListener("touchend",X));ia();T=new Aa;Ma()});
